---
title: "2.2: Modeling Neurons"
subtitle: "Deep Dive into Neuron Models with Neun"
format:
  html:
    toc: true
    toc-depth: 3
    code-fold: show
---

## Introduction

In this section, we'll explore single neuron models in depth, understanding their properties, behaviors, and how to use them effectively with Neun. While single neurons may seem simple, they exhibit rich dynamics that are essential for understanding network behavior.

## Exploring Neuron Models

### Hodgkin-Huxley (HH)

The classic biophysical neuron model with sodium and potassium conductances:

![Hodgkin-Huxley formalism equations](./images/HH-equations.png){width=80%}

```{.python filename="src/hh.py"}
{{< include src/hh.py >}}
```

**Observation**: Higher external current leads to:
- More frequent action potentials
- Higher firing rate
- Different spiking patterns

#### ðŸ’» Hands-on: 
Try different values of currents... Can you find the model's limit? 
Do you think a living neuron would have a similar limit?

### Hindmarsh-Rose (HR)

A reduced model that can produce bursting and chaotic behavior:

```{.python filename="src/hr.py"}
{{< include src/hr.py >}}
```

<!-- @TODO change this by Explanation of what is chaotic ? -->

### The Izhikevich Model

The Izhikevich model can reproduce many different firing patterns with just 4 parameters:

$$
\begin{aligned}
\frac{dV}{dt} &= 0.04V^2 + 5V + 140 - u + I \\
\frac{du}{dt} &= a(bV - u)
\end{aligned}
$$

When $V \geq 30$ mV: $V \to c$, $u \to u + d$

![Izhikevich neural activity types. From https://www.izhikevich.org/publications/spikes.htm](./images/izhik.gif){width=90%}

::: {.callout-important}
## Choosing Parameters

Izhikevich parameters:

- **a**: Recovery time scale (0.01-0.1)
- **b**: Sensitivity of u to V (0.2-0.25)
- **c**: Reset voltage (-65 to -50 mV)
- **d**: Reset shift of u (2-8)

Different combinations produce different firing patterns!
:::


```{.python filename="src/izhikevich.py"}
{{< include src/izhikevich.py >}}
```

::: {.callout-important}
## Choosing a Neuron Model

- **HH (Hodgkin-Huxley)**: Biophysically detailed, captures ion channel dynamics
- **HR (Hindmarsh-Rose)**: Bursting and chaotic behavior, moderate complexity
- **Izhikevich**: Various firing patterns with simple equations

**Integrator Selection**:

- **RK4**: Best balance of accuracy and speed (recommended)
- **RK6**: Higher accuracy for sensitive systems
- **Euler**: Fast but less accurate

**Precision**: Use `Double` for most cases, `Float` for large-scale simulations
:::

## Visualizing variables in the model

So far we have plot the voltage at each instant, but in the model we have access to all the parameters
that conform the model. Try out this example of Hodgkin-Huxley model showing several variables:

```{.python filename="src/hh-parameters.py"}
{{< include src/hh-parameters.py >}}
```

## Parameter Exploration

A key use of simulations is exploring parameter space which can be easily done in a model but can be quite of a challenge experimentally.

::: {.callout-tip}
## Parameter Exploration Tips

1. **Start with wide ranges** to understand overall behavior
2. **Refine** around interesting regions
3. **Vary one parameter at a time** initially
4. **Use multiple metrics** (firing rate, CV of ISI, etc.)
5. **Compare with experimental data** when available
:::

```{.python filename="src/parameter-exploration.py"}
{{< include src/parameter-exploration.py >}}
```

When designing a model is frequent the need of analyzing a wide range of values 
(and combinations of values), that task can be automatized by defining a range of exploration values
for different parameters, as you have in the following example:

```{.python filename="src/parameter-exploration-batch.py"}
{{< include src/parameter-exploration-batch.py >}}
```

Sometimes it is also usefull to run a same model several times, varying 
some parameters in the simulation, e.g., including a noisy input at different seeds. 
You can design a loop for that purpose and analyze it directly on Python.
You have an examples of batching in ```src/hh-multiple-trials.py``` and ```src/parameter-exploration-batch.py```

## Input Patterns
<!-- @TODO move to callout "to know more" -->

So far we have just included fixed real (float) values in 
the example models, but Neun supports [various input patterns](input-patterns.qmd) through `add_synaptic_input()`,
such as ramp current, sinusoidal currents, pulse trains...

## Noise and Variability

Real neurons operate in noisy environments. Let's explore how noise affects spiking in two ways. First, by adding noise as a synaptic current input. Then, by using the chaotic regime of some neuron models.

::: {.callout-note}
### Chaos vs Noise

The chaotic HR model demonstrates **deterministic chaos**: irregular behavior arising from deterministic equations without any random input. This is fundamentally different from noise-driven variability:

- **Chaotic**: Sensitive dependence on initial conditions, deterministic
- **Noisy**: Random fluctuations from external sources, stochastic

Both produce irregular spike patterns, but chaos is intrinsic to the neuron's dynamics!
:::

### Noisy Input Current

```{.python filename="src/noisy-input.py"}
{{< include src/noisy-input.py >}}
```

### Chaotic regime 


```{.python filename="src/chaotic-regime.py"}
{{< include src/chaotic-regime.py >}}
```

### Analyzing the change: Coefficient of Variation (CV) of ISI

The CV quantifies spike time variability:

```{.python filename="src/cv-isis.py"}
{{< include src/cv-isis.py >}}
```

### Exercises

Try these exercises to solidify your understanding:

1. **Parameter Sweep**: Create a 2D parameter sweep varying both `gna` and `gk` in the HH model
2. **Integrator Comparison**: Compare RK4 vs RK6 integrators for the same HH neuron
3. **Phase Plane**: Plot the (V, n) phase plane for the HH model
4. **Coupling Strength**: Explore how synapse conductance affects synchronization between two HR neurons
5. **Noise Effects**: Compare firing patterns with different noise levels in the input current

