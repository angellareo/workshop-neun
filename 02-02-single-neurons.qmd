---
title: "2.2: Modeling Neurons"
subtitle: "Deep Dive into Neuron Models with Neun"
format:
  html:
    toc: true
    toc-depth: 3
    code-fold: show
---

## Introduction

In this section, we'll explore single neuron models in depth, understanding their properties, behaviors, and how to use them effectively with Neun. While single neurons may seem simple, they exhibit rich dynamics that are essential for understanding network behavior.

## Exploring Neuron Models

::: {.panel-tabset}
### Hodgkin-Huxley (HH)

The classic biophysical neuron model with sodium and potassium conductances:

![Hodgkin-Huxley formalism equations](./images/HH-equations.png){width=80%}

```{.python filename="src/hh.py"}
{{< include src/hh.py >}}
```

**Observation**: Higher external current leads to:
- More frequent action potentials
- Higher firing rate
- Different spiking patterns

:::{.callout-tip}
#### Hands-on

Try different current values... ðŸ’»

Can you find the **model's limit**? Do you think a living neuron would have a similar limit?
:::

### Hindmarsh-Rose (HR)

A reduced model that can produce bursting and chaotic behavior:

\begin{cases}
\dot x = y - a x^{3} + b x^{2} + I - z \\
\dot y = c - d x^{2} - y \\
\dot z = r\big(s(x - x_R) - z\big)
\end{cases}



```{.python filename="src/hr.py"}
{{< include src/hr.py >}}
```

:::{.callout-tip}
#### Hands-on

<!-- @TODO Add exercise to change between regular and chaotic -->
Try changing the external current `I`... ðŸ’»

Can you observe transitions between **regular spiking** and **chaotic bursting**?

<details>
<summary>Solution</summary>
```python
# Change I to observe different behaviors
# I = 2.0  # Regular spiking
I = 3.2  # Chaotic bursting
```
</details>
:::


### Izhikevich (Iz)

The Izhikevich model can reproduce many different firing patterns with just 4 parameters:

$$
\begin{aligned}
\frac{dV}{dt} &= 0.04V^2 + 5V + 140 - u + I \\
\frac{du}{dt} &= a(bV - u)
\end{aligned}
$$

When $V \geq 30$ mV: $V \to c$, $u \to u + d$

![Izhikevich neural activity types. From https://www.izhikevich.org/publications/spikes.htm](./images/izhik.gif){width=90%}

```{.python filename="src/izhikevich.py"}
{{< include src/izhikevich.py >}}
```
:::{.callout-tip}
#### Hands-on

Now it's your turn! ðŸ’»

Try adding a new set of parameters `a`, `b`, `c`, and `d` to `neuron_types` dictionary, then see how they affect the firing patterns. Can you replicate the neuron types shown in the image above?

<details>
<summary>Solution</summary>
```python
# Here you have the complete set of parameters for different neuron types
neuron_types = {
    'Regular Spiking (RS)': {
        'a': 0.02, 'b': 0.2, 'c': -65, 'd': 8,
        'I_amp': 10, 'color': 'blue'
    },
    'Intrinsically Bursting (IB)': {
        'a': 0.02, 'b': 0.2, 'c': -55, 'd': 4,
        'I_amp': 10, 'color': 'green'
    },
    'Chattering (CH)': {
        'a': 0.02, 'b': 0.2, 'c': -50, 'd': 2,
        'I_amp': 10, 'color': 'red'
    },
    'Fast Spiking (FS)': {
        'a': 0.1, 'b': 0.2, 'c': -65, 'd': 2,
        'I_amp': 10, 'color': 'purple'
    },
    'Low-Threshold Spiking (LTS)': {
        'a': 0.02, 'b': 0.25, 'c': -65, 'd': 2,
        'I_amp': 10, 'color': 'orange'
    },
    'Resonator (RZ)': {
        'a': 0.1, 'b': 0.26, 'c': -65, 'd': 2,
        'I_amp': 3.5, 'color': 'brown'
    }
}
```
</details>
:::

::: {.callout-important}
## Choosing Parameters

Izhikevich parameters:

- **a**: Recovery time scale (0.01-0.1)
- **b**: Sensitivity of u to V (0.2-0.25)
- **c**: Reset voltage (-65 to -50 mV)
- **d**: Reset shift of u (2-8)

Different combinations produce different firing patterns!
:::

:::

::: {.callout-important}
## Choosing a Neuron Model

- **HH (Hodgkin-Huxley)**: Biophysically detailed, captures ion channel dynamics
- **HR (Hindmarsh-Rose)**: Bursting and chaotic behavior, moderate complexity
- **Izhikevich**: Various firing patterns with simple equations

**Integrator Selection**:

- **RK4**: Best balance of accuracy and speed (recommended)
- **RK6**: Higher accuracy for sensitive systems
- **Euler**: Fast but less accurate

**Precision**: Use `Double` for most cases, `Float` for large-scale simulations
:::

## Visualizing parameters and variables in the model

<details>
<summary>Obtaining parameter and variable values</summary>

So far we have plot the voltage at each instant, but in the model we have access to all the parameters
that conform the model. Try out this example of Hodgkin-Huxley model showing several variables:

```{.python filename="src/hh-parameters.py"}
{{< include src/hh-parameters.py >}}
```
</details>

<details>
<summary>Parameter exploration</summary>
A key use of simulations is exploring parameter space which can be easily done in a model but can be quite of a challenge experimentally.

::: {.callout-tip}
## Parameter Exploration Tips

1. **Start with wide ranges** to understand overall behavior
2. **Refine** around interesting regions
3. **Vary one parameter at a time** initially
4. **Use multiple metrics** (firing rate, CV of ISI, etc.)
5. **Compare with experimental data** when available
:::

```{.python filename="src/parameter-exploration.py"}
{{< include src/parameter-exploration.py >}}
```

Sometimes it is also usefull to run the same model several times, varying 
some parameters in the simulation, e.g., including a noisy input at different seeds. 
You can design a loop for that purpose and analyze it directly on Python.
You have an examples of batching in ```src/hh-multiple-trials.py``` and ```src/parameter-exploration-batch.py```

</details>





## Input Patterns
<!-- @TODO move to callout "to know more" -->

So far we have just included fixed real (float) values in 
the example models, but Neun supports [various input patterns](input-patterns.qmd) through `add_synaptic_input()`,
such as ramp current, sinusoidal currents, pulse trains...

## Noise and Variability

Real neurons operate in noisy environments. Noise affects spiking in two ways, so let's explore them. First, we'll simulate it by adding noise as a synaptic current input. Then, we'll use the chaotic regime of Hindmarsh-Rose.

::: {.callout-note}
### Chaos vs Noise

The chaotic HR model demonstrates **deterministic chaos**: irregular behavior arising from deterministic equations without any random input. This is fundamentally different from noise-driven variability:

- **Chaotic**: Sensitive dependence on initial conditions, deterministic
- **Noisy**: Random fluctuations from external sources, stochastic

Both produce irregular spike patterns, but chaos is intrinsic to the neuron's dynamics!
:::

:::{.panel-tabset}
### Noisy Input Current

```{.python filename="src/noisy-input.py"}
{{< include src/noisy-input.py >}}
```

### Chaotic regime 


```{.python filename="src/chaotic-regime.py"}
{{< include src/chaotic-regime.py >}}
```
:::

### Analyzing the change: Coefficient of Variation (CV) of ISI

The CV quantifies spike time variability:

```{.python filename="src/cv-isis.py"}
{{< include src/cv-isis.py >}}
```

### Exercises

Try these exercises to solidify your understanding:

1. **Parameter sweep**: Create a 2D parameter sweep varying both `gna` and `gk` in the HH model
2. **Phase plane**: Plot the (V, n) phase plane for the HH model
3. **Noise effects**: Compare firing patterns with different noise levels in the input current


**Continue to [2.3: Modeling Neural Networks](02-03-neural-networks.qmd)**
